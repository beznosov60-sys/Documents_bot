# Documents Bot

Бот для Telegram, который автоматически распознаёт данные с фотографий российского паспорта и сохраняет их в структурированном виде для последующей подстановки в документы.

## Возможности

- ✅ Использование **PaddleOCR** с русской языковой моделью для точного распознавания текста.
- ✅ Агрессивная предобработка изображений: нормализация контраста, подавление бликов, бинаризация и морфологическая фильтрация.
- ✅ Автоматическое выделение ключевых паспортных реквизитов (ФИО, серия, номер, кем и когда выдан, код подразделения).
- ✅ Формирование структурированных блоков данных, готовых для подстановки в шаблоны документов.
- ✅ Возможность сохранить предобработанное изображение и полный распознанный текст для ручной проверки.

## Требования

- Python 3.10+
- Системные зависимости OpenCV (для Linux достаточно `libgl1`/`libglib2.0-0`).
- Для CPU-версии PaddlePaddle под Linux/Windows: `pip install paddlepaddle==2.5.2`. Для GPU используйте соответствующий пакет (`paddlepaddle-gpu`).

Необходимые Python-библиотеки перечислены в [`requirements.txt`](requirements.txt):

```text
aiogram==3.4.1
python-dotenv==1.0.1
numpy==1.26.4
opencv-python==4.10.0.84
paddlepaddle==2.5.2
paddleocr==2.7.0.3
pillow==10.4.0
natasha==1.6.0
python-dateutil==2.9.0
```

## Установка и запуск

1. Создайте и активируйте виртуальное окружение:
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Linux / macOS
   .venv\\Scripts\\activate   # Windows PowerShell
   ```
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. Создайте файл `.env` в корне проекта и добавьте токен Telegram-бота:
   ```env
   TOKEN_BOT=123456789:ABCDEF...
   ```
4. Запустите бота:
   ```bash
   python -m bot.main
   ```

## Как это работает

1. Пользователь отправляет фотографию или скан паспорта боту.
2. Изображение сохраняется и проходит конвейер предобработки (`bot/utils/passport.py`):
   - нормализация контраста (CLAHE);
   - подавление бликов методом `cv2.inpaint`;
   - билатеральное сглаживание и адаптивная бинаризация;
   - морфологическое закрытие для усиления текстовых областей.
3. Предобработанный кадр подаётся в `PaddleOCR` для распознавания текста.
4. Натуральный язык обрабатывается библиотекой `natasha`: выделяются ФИО и даты.
5. Результат собирается в словарь с ключевыми полями и в блоки:
   - `personal` — ФИО;
   - `document_numbers` — серия и номер;
   - `issue` — кем и когда выдан, код подразделения;
   - `raw_text`, `raw_lines` — исходный OCR-текст.
6. Хэндлер `bot/handlers/ocr_passport.py` отправляет пользователю сводку, при необходимости прикладывает предобработанное изображение и полный текст для проверки.

## Структура проекта

```
Documents_bot/
├── bot/
│   ├── handlers/
│   │   ├── ocr_passport.py   # обработка входящих изображений
│   │   └── start.py          # приветственное сообщение /start
│   ├── utils/
│   │   └── passport.py       # конвейер предобработки и OCR
│   └── main.py               # точка входа Telegram-бота
├── requirements.txt
└── README.md
```

## Советы по улучшению распознавания

- Делайте фото при равномерном освещении, избегая резких теней.
- Размещайте паспорт ровно в кадре и следите за фокусом камеры.
- При сильных бликах попробуйте слегка изменить угол съёмки — алгоритм подавления бликов компенсирует отражения, но не восстановит полностью закрытый текст.

## Лицензия

Проект распространяется под лицензией MIT (если требуется другая лицензия — обновите раздел).
